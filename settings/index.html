<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<script type="text/javascript" src="/homey.js" data-origin="settings"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>

    <!-- NAVIGATION -->
    <nav class="navbar bg-dark navbar-dark" style="border-top-left-radius: 15px; border-top-right-radius: 15px;">
		<div class="container-fluid" style="padding-left:15px; padding-right:15px; padding-top: 15px; padding-bottom: 0px;">
			<table class="table table-borderless table-sm" style="text-align: center; vertical-align: middle; color: white">
			<thead>
				<tr>
					<th scope="col" id="tab-App" onclick="panelControl('panel-App')">Info</th> 
					<th scope="col" id="tab-Landroid" onclick="panelControl('panel-Landroid')">Landroid</th>  
					<th scope="col" id="tab-Landxcape" onclick="panelControl('panel-Landxcape')">LandXcape</th>  
					<th scope="col" id="tab-Kress" onclick="panelControl('panel-Kress')">Kress</th>  
					<th scope="col" id="tab-Ferrex" onclick="panelControl('panel-Ferrex')">Ferrex</th>  
					<th scope="col" id="tab-Log" onclick="panelControl('panel-Log')">Log</th>
				</tr>              
			</thead>
			</table>
		</div>
    </nav>
  
    <!-- PANEL APP INTRODUCTION -->
    <div id="panel-App" class="container-fluid" style="padding: 0px; display:none;">
		<div class="card">
			<h5 class="card-header bg-secondary text-white text-center">Introduction</h5>

			<div class="card-body">
				<p class="card-text" data-i18n="APP.text-appInfo"></p>
			</div>
			<br>
			<div class="form-check">
				<input class="form-check-input" type="checkbox" value="" id="checkLandroid">
				<label class="form-check-label" for="checkLandroid">
				Support Worx Landroid mowers
			</label>
			</div>
			<div class="form-check">
				<input class="form-check-input" type="checkbox" value="" id="checkLandxcape">
				<label class="form-check-label" for="checkLandroid">
				Support LandXcape mowers
			</label>
			</div>
			<div class="form-check">
				<input class="form-check-input" type="checkbox" value="" id="checkKress">
				<label class="form-check-label" for="checkLandroid">
				Support Kress mowers
			</label>
			</div>
			<div class="form-check">
				<input class="form-check-input" type="checkbox" value="" id="checkFerrex">
				<label class="form-check-label" for="checkLandroid">
				Support Ferrex mowers
			</label>
			</div>
		
			<h5 class="card-footer bg-secondary text-white text-center" style="border-bottom-left-radius: 15px; border-bottom-right-radius: 15px;"></h5>
		</div>

    </div>

        <!-- PANEL LANDROID -->
    <div id="panel-Landroid" class="container-fluid" style="padding: 0px; display:none;">

		<div class="card">
			<h5 class="card-header bg-secondary text-white text-center">Credentials</h5>
			<div class="card-body d-grid">
				<div class="input-group input-group-sm">
					<textarea class="form-control" id="user-Landroid" type="text" placeholder="User Landroid" rows="2"></textarea>
				</div>
				<div class="input-group input-group-sm">
					<textarea class="form-control" id="password-Landroid" type="text" placeholder="Password Landroid" rows="2" style="color: transparent; text-shadow: 0 0 8px black"></textarea>
					<span class="input-group-text" id="showSettings-Landroid" onclick="ShowSecret('password-Landroid')" style="color: blue; width: 10%">&#128065</span>            
				</div>
				<br>
					<label for="debug-Landroid">Enable Debug Info</label>
					<input type="checkbox" role="switch" id="debug-Landroid" />
				<br>
				<button id="save-Landroid" type="button" class="btn btn-outline-secondary btn-block" data-i18n="forms.save-Landroid" style="display:none"></button>
			</div>
			<h5 class="card-footer bg-secondary text-white text-center" style="border-bottom-left-radius: 15px; border-bottom-right-radius: 15px;"></h5>

		</div>
      
    </div>

    <!-- PANEL KRESS -->
    <div id="panel-Kress" class="container-fluid" style="padding: 0px; display:none;">

		<div class="card">
			<h5 class="card-header bg-secondary text-white text-center">Credentials</h5>
			<div class="card-body d-grid">
				<div class="input-group input-group-sm">
					<textarea class="form-control" id="user-Kress" type="text" placeholder="User Kress" rows="2"></textarea>
				</div>
				<div class="input-group input-group-sm">
					<textarea class="form-control" id="password-Kress" type="text" placeholder="Password Kress" rows="2" style="color: transparent; text-shadow: 0 0 8px black"></textarea>
					<span class="input-group-text" id="showSettings-Kress"onclick="ShowSecret('password-Kress')" style="color: blue; width: 10%">&#128065</span> 
				</div>
				<br>
					<label for="debug-Kress">Enable Debug Info</label>
					<input type="checkbox" role="switch" id="debug-Kress" />
				<br>
				<button id="save-Kress" type="button" class="btn btn-outline-secondary btn-block" data-i18n="forms.save-Kress" style="display:none"></button>
			</div>
			<h5 class="card-footer bg-secondary text-white text-center" style="border-bottom-left-radius: 15px; border-bottom-right-radius: 15px;"></h5>
		</div>
      
    </div>

    <!-- PANEL LANDXCAPE -->
    <div id="panel-Landxcape" class="container-fluid" style="padding: 0px; display:none;">

		<div class="card">
			<h5 class="card-header bg-secondary text-white text-center">Credentials</h5>
			<div class="card-body d-grid">
				<div class="input-group input-group-sm">
					<textarea class="form-control" id="user-Landxcape" type="text" placeholder="User Landxcape" rows="2"></textarea>
				</div>
				<div class="input-group input-group-sm">
					<textarea class="form-control" id="password-Landxcape" type="text" placeholder="Password Landxcape" rows="2" style="color: transparent; text-shadow: 0 0 8px black"></textarea>
					<span class="input-group-text" id="showSettings-Landxcape"onclick="ShowSecret('password-Landxcape')" style="color: blue; width: 10%">&#128065</span> 
				</div>
				<br>
					<label for="debug-Landxcape">Enable Debug Info</label>
					<input type="checkbox" role="switch" id="debug-Landxcape" />
				<br>
				<button id="save-Landxcape" type="button" class="btn btn-outline-secondary btn-block" data-i18n="forms.save-Landxcape" style="display:none"></button>
			</div>
			<h5 class="card-footer bg-secondary text-white text-center" style="border-bottom-left-radius: 15px; border-bottom-right-radius: 15px;"></h5>
		</div>
      
    </div>

    <!-- PANEL FERREX -->
    <div id="panel-Ferrex" class="container-fluid" style="padding: 0px; display:none;">

		<div class="card">
			<h5 class="card-header bg-secondary text-white text-center">Credentials</h5>
			<div class="card-body d-grid">
			<div class="input-group input-group-sm">
				<textarea class="form-control" id="user-Ferrex" type="text" placeholder="User Ferrex" rows="2"></textarea>
			</div>
			<div class="input-group input-group-sm">
				<textarea class="form-control" id="password-Ferrex" type="text" placeholder="Password Ferrex" rows="2" style="color: transparent; text-shadow: 0 0 8px black"></textarea>
				<span class="input-group-text" id="showSettings-Ferrex"onclick="ShowSecret('password-Ferrex')" style="color: blue; width: 10%">&#128065</span> 
			</div>
			<br>
				<label for="debug-Ferrex">Enable Debug Info</label>
				<input type="checkbox" role="switch" id="debug-Ferrex" />
			<br>
			<button id="save-Ferrex" type="button" class="btn btn-outline-secondary btn-block" data-i18n="forms.save-Ferrex" style="display:none"></button>
			</div>
			<h5 class="card-footer bg-secondary text-white text-center" style="border-bottom-left-radius: 15px; border-bottom-right-radius: 15px;"></h5>
		</div>
      
    </div>

	<!-- PANEL LOG -->
	<div id="panel-Log" class="container-fluid" style="padding: 0px; display:none;">

	<div class="card">
		<h5 class="card-header bg-secondary text-white text-center">Logging</h5>
		<div class="card-body d-grid">
			<button id="copyLog" type="button" class="btn btn-outline-secondary btn-block">Copy Log to Clipboard</button>
			<button id="clearLog" type="button" class="btn btn-outline-secondary btn-block">Clear Log</button>
		</div>
		<div id="loglines"> </div>
		<h5 class="card-footer bg-secondary text-white text-center" style="border-bottom-left-radius: 15px; border-bottom-right-radius: 15px;"></h5>
	</div>

	</div>


</body>
</html>
<script type="text/javascript">

	const panelApp = document.getElementById('panel-App')
	const panelLandroid = document.getElementById('panel-Landroid')
	const panelLandxcape = document.getElementById('panel-Landxcape')
	const panelKress = document.getElementById('panel-Kress')
	const panelFerrex = document.getElementById('panel-Ferrex')
	const panelLog = document.getElementById('panel-Log')
	const loglinesElement = document.getElementById('loglines');

	const tabAppElement = document.getElementById('tab-App');
	const tabLandroidElement = document.getElementById('tab-Landroid');
	const tabLandxcapeElement = document.getElementById('tab-Landxcape');
	const tabKressElement = document.getElementById('tab-Kress');
	const tabFerrexElement = document.getElementById('tab-Ferrex');
	const tabLogElement = document.getElementById('tab-Log');

	const supportLandroid = document.getElementById('checkLandroid');
	const supportLandxcape = document.getElementById('checkLandxcape');
	const supportKress = document.getElementById('checkKress');
	const supportFerrex = document.getElementById('checkFerrex');

	const userLandroidElement =document.getElementById('user-Landroid');
	const userLandxcapeElement =document.getElementById('user-Landxcape');
	const userKressElement =document.getElementById('user-Kress');
	const userFerrexElement =document.getElementById('user-Ferrex');

	const passwordLandroidElement =document.getElementById('password-Landroid');
	const passwordLandxcapeElement =document.getElementById('password-Landxcape');
	const passwordKressElement =document.getElementById('password-Kress');
	const passwordFerrexElement =document.getElementById('password-Ferrex');

	const debugLandroidElement =document.getElementById('debug-Landroid');
	const debugLandxcapeElement =document.getElementById('debug-Landxcape');
	const debugKressElement =document.getElementById('debug-Kress');
	const debugFerrexElement =document.getElementById('debug-Ferrex');

	const saveLandroidElement =document.getElementById('save-Landroid');
	const saveLandxcapeElement =document.getElementById('save-Landxcape');
	const saveKressElement =document.getElementById('save-Kress');
	const saveFerrexElement =document.getElementById('save-Ferrex');

	const copyLog = document.getElementById('copyLog');
	const clearLog = document.getElementById('clearLog');

	var settingsLandroid = {};
	var settingsLandxcape = {};
	var settingsKress = {};
	var settingsFerrex = {};

	function displayLogs(lines) {
		loglinesElement.innerHTML = lines;
	}

	function updateLogs() {

		try {
			displayLogs('<table class="table table-sm text-nowrap" style="width: 1200px; padding: 1px; font-size: smaller;"><tr class="table-info"><td>Refreshing......</td></tr></table>');

			Homey.api('GET', '/getLogs/', null, (err, result) => {
				if (!err) {
				let lines = '<table class="table table-sm text-nowrap" id="logTable" style="width: 1200px; padding: 1px; font-size: smaller;">';
				if (Array.isArray(result) && result.length > 0) {
					result
					.reverse()
					.forEach((line) => {
					lines += `<tr>${line}</tr>`;
					});
				}
				lines += '</table>'
				displayLogs(lines);
				} 	else {
				displayLogs(`table class="table table-sm text-nowrap" style="width: 1200px; padding: 1px; font-size: smaller;"><tr class="table-danger"><td>${err}</td></tr></table>`);
				}
			});
		} catch (e) {
			displayLogs(`<table class="table table-sm text-nowrap" style="width: 1200px; padding: 1px; font-size: smaller;"><tr class="table-danger"><td>${e}</td></tr></table>`);
		}
	}

	function clearLogs() {
		try {
			displayLogs('');

			Homey.api('GET', '/clearLogs/', null, (err) => {
				if (!err) {
					updateLogs();
					displayLogs(lines);
				} else {
					displayLogs(err);
				}
			});
		} 	catch (e) {
			displayLogs(e);
		}
	}

  	function tableToClipboard (element) {
		var text;
		for (var i = 0, row; row = element.rows[i]; i++) {
			text = text + row.cells[0].innerHTML
		}
		var dummyTab = document.createElement("textarea");
		document.body.appendChild(dummyTab);
		dummyTab.value = text;
		dummyTab.select();
		document.execCommand("copy");
		document.body.removeChild(dummyTab);
	}

  	function ShowSecret(element) {

		if (document.getElementById(element).style.color === "transparent") {
			document.getElementById(element).style = document.getElementById("user-Landroid").style;
		} else {
			document.getElementById(element).style.color = "transparent";
			document.getElementById(element).style.textShadow = "0 0 8px black";
			document.getElementById(element).style.display = "block";
		}
  	}

  	function panelControl(action) {
		panelLandroid.style.display = 'none';
		panelLandxcape.style.display = 'none';
		panelKress.style.display = 'none';
		panelFerrex.style.display = 'none';
		panelLog.style.display = 'none';
		loglinesElement.style.display = 'none';
		panelApp.style.display = 'none';

		tabAppElement.style.backgroundColor = '#212529' // bg-dark
		tabLandroidElement.style.backgroundColor = '#212529' // bg-dark
		tabLandxcapeElement.style.backgroundColor = '#212529' // bg-dark
		tabKressElement.style.backgroundColor = '#212529' // bg-dark
		tabFerrexElement.style.backgroundColor = '#212529' // bg-dark
		tabLogElement.style.backgroundColor = '#212529' // bg-dark

		switch (action) {
			case 'panel-App':
				panelApp.style.display = 'block';
				tabAppElement.style.backgroundColor = '#6c757d' // bg-secondary
				break;
			case 'panel-Landroid':
				panelLandroid.style.display = 'block';
				tabLandroidElement.style.backgroundColor = '#6c757d' // bg-secondary
				break;
			case 'panel-Landxcape':
				panelLandxcape.style.display = 'block';
				tabLandxcapeElement.style.backgroundColor = '#6c757d' // bg-secondary
				break;
			case 'panel-Kress':
				panelKress.style.display = 'block';
				tabKressElement.style.backgroundColor = '#6c757d' // bg-secondary
				break;
			case 'panel-Ferrex':
				panelFerrex.style.display = 'block';
				tabFerrexElement.style.backgroundColor = '#6c757d' // bg-secondary
				break;
			case 'panel-Log':
				panelLog.style.display = 'block';
				loglinesElement.style.display = 'block';
				tabLogElement.style.backgroundColor = '#6c757d' // bg-secondary
				updateLogs();
				break;
			default:
		};
	}

  	function onHomeyReady(Homey) {

    Homey.get('worx', (err, settings) => {
		if ( err ) {
			return Homey.alert(`Get Landroid Settings Error ${err}`);
		} 
		LandroidSettings = settings;
		userLandroidElement.value = LandroidSettings.username;
		passwordLandroidElement.value = LandroidSettings.password;
		debugLandroidElement.checked = LandroidSettings.debug;
		if (userLandroidElement.value > '') tabLandroidElement.style.display = 'block'; else tabLandroidElement.style.display = 'none';
		if (userLandroidElement.value > '') supportLandroid.checked = true; else supportLandroid.checked = false;
    });

    Homey.get('landxcape', (err, settings) => {
		if ( err ) {
			return Homey.alert(`Get Landxcape Settings Error ${err}`);
		} 
		LandxcapeSettings = settings;
		userLandxcapeElement.value = LandxcapeSettings.username;
		passwordLandxcapeElement.value = LandxcapeSettings.password;
		debugLandxcapeElement.checked = LandxcapeSettings.debug;
		if (userLandxcapeElement.value > '') tabLandxcapeElement.style.display = 'block'; else tabLandxcapeElement.style.display = 'none';
		if (userLandxcapeElement.value > '') supportLandxcape.checked = true; else supportLandxcape.checked = false;
    });

    Homey.get('kress', (err, settings) => {
		if ( err ) {
			return Homey.alert(`Get Kress Settings Error${err}`);
		} 
		KressSettings = settings;
		userKressElement.value = KressSettings.username;
		passwordKressElement.value = KressSettings.password;
		debugKressElement.checked = KressSettings.debug;
		if (userKressElement.value > '') tabKressElement.style.display = 'block'; else tabKressElement.style.display = 'none';
		if (userKressElement.value > '') supportKress.checked = true; else supportKress.checked = false;
    });

    Homey.get('ferrex', (err, settings) => {
		if ( err ) {
			return Homey.alert(`Get Ferrex Settings Error${err}`);
		} 
		FerrexSettings = settings;
		userFerrexElement.value = FerrexSettings.username;
		passwordFerrexElement.value = FerrexSettings.password;
		debugFerrexElement.checked = FerrexSettings.debug;
		if (userFerrexElement.value > '') tabFerrexElement.style.display = 'block'; else tabFerrexElement.style.display = 'none';
		if (userFerrexElement.value > '') supportFerrex.checked = true; else supportFerrex.checked = false;
    });

	Homey.on('Invalid', (err) => {
      	return Homey.alert(err);
    });

    supportLandroid.addEventListener('click', function (e) {
      	if (supportLandroid.checked === true) tabLandroidElement.style.display = 'block'; else tabLandroidElement.style.display = 'none';
    });
    supportLandxcape.addEventListener('click', function (e) {
      	if (supportLandxcape.checked === true) tabLandxcapeElement.style.display = 'block'; else tabLandxcapeElement.style.display = 'none';
    });
    supportKress.addEventListener('click', function (e) {
      	if (supportKress.checked === true) tabKressElement.style.display = 'block'; else tabKressElement.style.display = 'none';
    });
    supportFerrex.addEventListener('click', function (e) {
      	if (supportFerrex.checked === true) tabFerrexElement.style.display = 'block'; else tabFerrexElement.style.display = 'none';
    });

    saveLandroidElement.addEventListener('click', function (e) {
		LandroidSettings.username = userLandroidElement.value.trim();
		LandroidSettings.password = passwordLandroidElement.value.trim();
		LandroidSettings.debug = debugLandroidElement.checked;

		Homey.set('worx', LandroidSettings , function( err ){
			if (err) return Homey.alert('Set Landroid Settings Error', err);
		}); 

		saveLandroidElement.style.display = 'none';
    });

    saveLandxcapeElement.addEventListener('click', function (e) {
		LandxcapeSettings.username = userLandxcapeElement.value.trim();
		LandxcapeSettings.password = passwordLandxcapeElement.value.trim();
		LandxcapeSettings.debug = debugLandxcapeElement.checked;

		Homey.set('landxcape', LandxcapeSettings , function( err ){
			if (err) return Homey.alert('Set LandXcape Settings Error', err);
		}); 

		saveLandxcapeElement.style.display = 'none';
    });

    saveKressElement.addEventListener('click', function (e) {
		KressSettings.username = userKressElement.value.trim();
		KressSettings.password = passwordKressElement.value.trim();
		KressSettings.debug = debugKressElement.checked;

		Homey.set('kress', KressSettings , function( err ){
			if (err) return Homey.alert('Set Kress Settings Error', err);
		}); 

		saveKressElement.style.display = 'none';
    });

    saveFerrexElement.addEventListener('click', function (e) {
		FerrexSettings.username = userFerrexElement.value.trim();
		FerrexSettings.password = passwordFerrexElement.value.trim();
		FerrexSettings.debug = debugFerrexElement.checked;

		Homey.set('ferrex', FerrexSettings , function( err ){
			if (err) return Homey.alert('Set Ferrex Settings Error', err);
		}); 

		saveFerrexElement.style.display = 'none';
    });

    //Check on each panel if all fields have been inputted when something changes and move to NEST panel
    panelLandroid.addEventListener('input', function (e) {
      	saveLandroidElement.style.display = 'block';
    });

    panelLandxcape.addEventListener('input', function (e) {
      	saveLandxcapeElement.style.display = 'block';
    });

    panelKress.addEventListener('input', function (e) {
      	saveKressElement.style.display = 'block';
    });

    panelFerrex.addEventListener('input', function (e) {
      	saveFerrexElement.style.display = 'block';
    });

    copyLog.addEventListener('click', function (e) {
			tableToClipboard(document.getElementById('logTable'));
	});

    clearLog.addEventListener('click', function (e) {
			clearLogs();
	});

    panelControl('panel-App');
    Homey.ready();

  }
</script>